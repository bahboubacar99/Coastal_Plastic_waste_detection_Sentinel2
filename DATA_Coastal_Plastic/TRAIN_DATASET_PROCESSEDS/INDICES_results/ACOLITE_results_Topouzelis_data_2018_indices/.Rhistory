### classifier un raster######################################
classifier <- predict(model, newdata = data_zone_etude)
# Convertir les prédictions en un objet raster
# Créer un raster avec les mêmes dimensions que votre raster d'entrée
raster_classifier <- raster(rhos_band)
# Assigner les prédictions aux cellules du raster
values(raster_classifier) <- classifier
chemin_sortie <- "G:/BAH_project"
setwd(chemin_sortie)
writeRaster(raster_classifier, "classifier_RF.tif", overwrite= TRUE)
# Visualiser le raster de prédictions
plot(raster_classifier)
setwd(chemin_entre)
}
library(ggplot2)
library(lattice)
library(caret)
library(raster)
chemin_entre <- "G:/BAH_project/Image_sentinel_2/TRAIN_DATASET_PROCESSEDS/INDICES_results/ACOLITE_results_Topouzelis_data_2018_indices"
setwd(chemin_entre)
setwd(chemin_entre)
liste_dossiers <- list.dirs(path='.')
setwd(chemin_entre)
setwd(liste_dossiers[i])
all_band <- list.files(pattern='*.tif$')
rhos_band_all<- grep(all_band, pattern='unmixed', invert=TRUE, value=TRUE)
rhos_band_unmixed_all<-grep(all_band, pattern='unmixed', invert=FALSE, value=TRUE)
if(length(rhos_band_unmixed_all)>0){
for (n in rhos_band_all) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all[n]
rhos_band <- brick(rhos_band_all[n])
rhos_band_unmixed <- brick(rhos_band_unmixed_all[n])
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(fussion[[1:7]])
plot(fussion[[8:14]])
plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(fussion))
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
}
}else{
for (n in rhos_band_all) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all
rhos_band <- brick(rhos_band_all[n])
#rhos_band_unmixed <- brick(rhos_band_unmixed_all)
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
#band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
#names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
#extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
#fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(rhos_band[[1:7]])
plot(rhos_band[[8:14]])
#plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(rhos_band))
# Identifier les colonnes manquantes dans raster_df
colonnes_manquantes <- setdiff(table_data, colnames(raster_df))
# Ajouter les colonnes manquantes à raster_df avec des valeurs NA
if (length(colonnes_manquantes) > 0) {
for (colonne in colonnes_manquantes) {
raster_df[[colonne]] <- NA
}
}
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
# on change les NA du tableau par des 0
data_zone_etude[is.na(data_zone_etude)] <- 0
}
}
nom_raster_classifier
rhos_band
rhos_band_all
rhos_band_all[1]
length(rhos_band_all)
library(ggplot2)
library(lattice)
library(caret)
library(raster)
chemin_entre <- "G:/BAH_project/Image_sentinel_2/TRAIN_DATASET_PROCESSEDS/INDICES_results/ACOLITE_results_Topouzelis_data_2018_indices"
setwd(chemin_entre)
setwd(chemin_entre)
setwd(chemin_entre)
setwd(liste_dossiers[i])
all_band <- list.files(pattern='*.tif$')
rhos_band_all<- grep(all_band, pattern='unmixed', invert=TRUE, value=TRUE)
rhos_band_unmixed_all<-grep(all_band, pattern='unmixed', invert=FALSE, value=TRUE)
if(length(rhos_band_unmixed_all)>0){
for (n in 1: length(rhos_band_all) ) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all[n]
rhos_band <- brick(rhos_band_all[n])
rhos_band_unmixed <- brick(rhos_band_unmixed_all[n])
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(fussion[[1:7]])
plot(fussion[[8:14]])
plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(fussion))
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
}
}else{
for (n in 1: length(rhos_band_all)) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all
rhos_band <- brick(rhos_band_all[n])
#rhos_band_unmixed <- brick(rhos_band_unmixed_all)
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
#band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
#names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
#extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
#fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(rhos_band[[1:7]])
plot(rhos_band[[8:14]])
#plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(rhos_band))
# Identifier les colonnes manquantes dans raster_df
colonnes_manquantes <- setdiff(table_data, colnames(raster_df))
# Ajouter les colonnes manquantes à raster_df avec des valeurs NA
if (length(colonnes_manquantes) > 0) {
for (colonne in colonnes_manquantes) {
raster_df[[colonne]] <- NA
}
}
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
# on change les NA du tableau par des 0
data_zone_etude[is.na(data_zone_etude)] <- 0
}
}
# Charger les données############################################################
chemin <- "G:/BAH_project/code_R"
setwd(chemin)
data <- read.csv("data_test.csv", sep = ";")
# Diviser les données en ensembles d'entraînement et de test
set.seed(123)
data_train <- data
# Entraîner le modèle Naïve Bayes
model <- train(id ~ ., data = data_train, method = "rf")
### classifier un raster######################################
classifier <- predict(model, newdata = data_zone_etude)
# Convertir les prédictions en un objet raster
# Créer un raster avec les mêmes dimensions que votre raster d'entrée
raster_classifier <- raster(rhos_band)
# Assigner les prédictions aux cellules du raster
values(raster_classifier) <- classifier
chemin_sortie <- "G:/BAH_project"
setwd(chemin_sortie)
writeRaster(raster_classifier, "classifier_RF.tif", overwrite= TRUE)
# Visualiser le raster de prédictions
plot(raster_classifier)
setwd(chemin_entre)
library(ggplot2)
library(lattice)
library(caret)
library(raster)
chemin_entre <- "G:/BAH_project/Image_sentinel_2/TRAIN_DATASET_PROCESSEDS/INDICES_results/ACOLITE_results_Topouzelis_data_2018_indices"
setwd(chemin_entre)
setwd(chemin_entre)
liste_dossiers <- list.dirs(path='.')
for (i in 1: length(liste_dossiers)) {
setwd(chemin_entre)
setwd(liste_dossiers[i])
all_band <- list.files(pattern='*.tif$')
rhos_band_all<- grep(all_band, pattern='unmixed', invert=TRUE, value=TRUE)
rhos_band_unmixed_all<-grep(all_band, pattern='unmixed', invert=FALSE, value=TRUE)
if(length(rhos_band_unmixed_all)>0){
for (n in 1: length(rhos_band_all) ) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all[n]
rhos_band <- brick(rhos_band_all[n])
rhos_band_unmixed <- brick(rhos_band_unmixed_all[n])
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(fussion[[1:7]])
plot(fussion[[8:14]])
plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(fussion))
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
}
}else{
for (n in 1: length(rhos_band_all)) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all
rhos_band <- brick(rhos_band_all[n])
#rhos_band_unmixed <- brick(rhos_band_unmixed_all)
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
#band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
#names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
#extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
#fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(rhos_band[[1:7]])
plot(rhos_band[[8:14]])
#plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(rhos_band))
# Identifier les colonnes manquantes dans raster_df
colonnes_manquantes <- setdiff(table_data, colnames(raster_df))
# Ajouter les colonnes manquantes à raster_df avec des valeurs NA
if (length(colonnes_manquantes) > 0) {
for (colonne in colonnes_manquantes) {
raster_df[[colonne]] <- NA
}
}
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
# on change les NA du tableau par des 0
data_zone_etude[is.na(data_zone_etude)] <- 0
}
}
# Charger les données############################################################
chemin <- "G:/BAH_project/code_R"
setwd(chemin)
data <- read.csv("data_test.csv", sep = ";")
# Diviser les données en ensembles d'entraînement et de test
set.seed(123)
#trainIndex <- createDataPartition(data$id, p = .8, list = FALSE, times = 1)
data_train <- data
#data_test  <- data[-trainIndex,]
# Entraîner le modèle Naïve Bayes
model <- train(id ~ ., data = data_train, method = "rf")
# Prédire les classes pour les données de test  naive_bayes
#predictions <- predict(model, newdata = data_test)
## convertion des des colonne id en factor
#data_test$id <- as.factor(data_test$id)
# Évaluer les performances du modèle
#matrix_confusion <- confusionMatrix(predictions, data_test$id)
### classifier un raster######################################
classifier <- predict(model, newdata = data_zone_etude)
# Convertir les prédictions en un objet raster
# Créer un raster avec les mêmes dimensions que votre raster d'entrée
raster_classifier <- raster(rhos_band)
# Assigner les prédictions aux cellules du raster
values(raster_classifier) <- classifier
chemin_sortie <- "G:/BAH_project"
setwd(chemin_sortie)
writeRaster(raster_classifier, "classifier_RF.tif", overwrite= TRUE)
# Visualiser le raster de prédictions
plot(raster_classifier)
setwd(chemin_entre)
}
library(ggplot2)
library(lattice)
library(caret)
library(raster)
# Répertoire pour les résultats indices
#chemin_raster <- "G:/BAH_project/Image_sentinel_2/TRAIN_DATASET_PROCESSEDS/INDICES_results"
chemin_entre <- "G:/BAH_project/Image_sentinel_2/TRAIN_DATASET_PROCESSEDS/INDICES_results/ACOLITE_results_Topouzelis_data_2018_indices"
setwd(chemin_entre)
setwd(chemin_entre)
liste_dossiers <- list.dirs(path='.')
for (i in 1: length(liste_dossiers)) {
setwd(chemin_entre)
setwd(liste_dossiers[i])
all_band <- list.files(pattern='*.tif$')
rhos_band_all<- grep(all_band, pattern='unmixed', invert=TRUE, value=TRUE)
rhos_band_unmixed_all<-grep(all_band, pattern='unmixed', invert=FALSE, value=TRUE)
if(length(rhos_band_unmixed_all)>0){
for (n in 1: length(rhos_band_all) ) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all[n]
rhos_band <- brick(rhos_band_all[n])
rhos_band_unmixed <- brick(rhos_band_unmixed_all[n])
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(fussion[[1:7]])
plot(fussion[[8:14]])
plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(fussion))
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
}
}else{
for (n in 1: length(rhos_band_all)) {
## convertion en raster brick###########################################################
nom_raster_classifier <- rhos_band_all
rhos_band <- brick(rhos_band_all[n])
#rhos_band_unmixed <- brick(rhos_band_unmixed_all)
########renomme les bandes ###############################################################
band_name<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "NDVI", "KNDVI", "PI", "NIR_prime", "FDI")
#band_name_unmixe <- c("plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance", "long", "lat")
names(rhos_band)<- band_name
#names(rhos_band_unmixed)<- band_name_unmixe
### mettre les deux raster a la  même extension #################################
#extent(rhos_band_unmixed) <- extent(rhos_band)
# Fusionner les deux rasters en un seul en spécifiant les bandes à conserver
#fussion <- stack(rhos_band, rhos_band_unmixed[[1:6]])
##############affichage des bandes #############################################
plot(rhos_band[[1:7]])
plot(rhos_band[[8:14]])
#plot(fussion[[15:21]])
##creation tableau data test ###################################"
table_data<- c("cotier", "blue", "green", "red", "redE1", "redE2", "redE3", "NIR", "NIR_A", "MIR_1", "MIR_2", "FDI", "KNDVI", "NDVI", "NIR_prime", "PI",
"plastics_bottles_abundance", "fish_net_abundance", "blue_bags_abundance", "water_abundance", "HDPE_abundance", "wooden_abundance")
data_zone_etude <- data.frame(matrix(nrow = 0, ncol = length(table_data)))
colnames(data_zone_etude)<- table_data
### # Convertition du RasterStack en data.frame
raster_df <- as.data.frame(getValues(rhos_band))
# Identifier les colonnes manquantes dans raster_df
colonnes_manquantes <- setdiff(table_data, colnames(raster_df))
# Ajouter les colonnes manquantes à raster_df avec des valeurs NA
if (length(colonnes_manquantes) > 0) {
for (colonne in colonnes_manquantes) {
raster_df[[colonne]] <- NA
}
}
# verifier si raster_df contient les meme nom de colonne que  table_data
raster_df <- raster_df[, colnames(raster_df) %in% table_data]
# Réorganiser les colonnes de raster_df dans le même ordre que table_data
raster_df <- raster_df[, table_data]
# Vérifier le nombre de lignes de raster_df
nb_lignes_raster_df <- nrow(raster_df)
# Ajuster le nombre de lignes de data_zone_etude pour correspondre à raster_df
data_zone_etude <- data_zone_etude[1:nb_lignes_raster_df, ]
# Ajouter les données à data_zone_etude
data_zone_etude <- raster_df
# on change les NA du tableau par des 0
data_zone_etude[is.na(data_zone_etude)] <- 0
}
}
# Charger les données############################################################
chemin <- "G:/BAH_project/code_R"
setwd(chemin)
data <- read.csv("data_test.csv", sep = ";")
# Diviser les données en ensembles d'entraînement et de test
set.seed(123)
#trainIndex <- createDataPartition(data$id, p = .8, list = FALSE, times = 1)
data_train <- data
#data_test  <- data[-trainIndex,]
# Entraîner le modèle Naïve Bayes
model <- train(id ~ ., data = data_train, method = "rf")
# Prédire les classes pour les données de test  naive_bayes
#predictions <- predict(model, newdata = data_test)
## convertion des des colonne id en factor
#data_test$id <- as.factor(data_test$id)
# Évaluer les performances du modèle
#matrix_confusion <- confusionMatrix(predictions, data_test$id)
### classifier un raster######################################
classifier <- predict(model, newdata = data_zone_etude)
# Convertir les prédictions en un objet raster
# Créer un raster avec les mêmes dimensions que votre raster d'entrée
raster_classifier <- raster(rhos_band)
# Assigner les prédictions aux cellules du raster
values(raster_classifier) <- classifier
chemin_sortie <- "G:/BAH_project"
setwd(chemin_sortie)
writeRaster(raster_classifier, "classifier_RF.tif", overwrite= TRUE)
# Visualiser le raster de prédictions
plot(raster_classifier)
setwd(chemin_entre)
}
nom_raster_classifier
nom_raster_classifier<- nom_raster_classifier[-3]
nom_raster_classifier
names(nom_raster_classifier)
date_im <- substring(nom_raster_classifier, 1, 48)
date_im
date_im <- substring(nom_raster_classifier, 1, 12)
date_im
date_im <- substring(nom_raster_classifier, 1, 45)
date_im
date_im <- substring(nom_raster_classifier, 1, 30)
date_im
date_im <- substring(nom_raster_classifier, 1, 38)
date_im
